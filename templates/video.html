<!--
 * @Author: Headmaster1615  e-mail:hm-218@qq.com
 * @Date: 2023-05-31 19:43:12
 * @LastEditors: Headmaster1615(Mac)  e-mail:hm-218@qq.com
 * @LastEditTime: 2023-11-07 10:21:00
 * @FilePath: \ä¸ªäººæœåŠ¡å™¨\templates\video.html
 * @Description: 
 * 
 * Copyright (c) 2023 by Headmaster1615, All Rights Reserved. 
-->
<!DOCTYPE html>
<html>
<head>
    <title>è§†é¢‘æ’­æ”¾å™¨</title>
    <meta charset="utf-8">
    <style>
        /* è§†é¢‘å®¹å™¨ï¼Œæ ¹æ®å±å¹•å®½åº¦è‡ªåŠ¨è°ƒæ•´é«˜åº¦ */
        .video-container {
            width: 100%;
            height: 0;
            padding-bottom: 56.25%; /* å®½é«˜æ¯”ä¸º16:9æ—¶çš„å€¼ */
            overflow: hidden;
            position: relative;
            display: flex; /* æ·»åŠ flexå¸ƒå±€ */
            justify-content: center; /* æ²¿æ°´å¹³å±…ä¸­å¯¹é½ */
            align-items: center; /* æ²¿å‚ç›´å±…ä¸­å¯¹é½ */
            margin: 0%;
            }
        /* è§†é¢‘å…ƒç´ ï¼Œæœ€å¤§é™åº¦å¡«å……çˆ¶å®¹å™¨ */
        .video-container video {
            width: 100%;
            height: 100%;
            object-fit: contain; /* å¡«å……æ–¹å¼ï¼šç­‰æ¯”ç¼©æ”¾å¹¶è£å‰ª */
            position: absolute;
            top: 0;
            left: 0;
        }

        body {
            background-image: url('/static/pic_bgd.jpg');
            background-size: cover;
        }

        h3,
        p {
            color: rgb(255, 255, 255);
            margin: 0%;
            /* è®¾ç½®é¢œè‰² */
        }

        /* è®¾ç½®æ»‘å—å®¹å™¨æ ·å¼ */
        .slider-container {
            width: 80%;
            margin: 0 auto;
        }


        /* æ»‘å—æ ·å¼ */
        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            height: 5px;
            background: #ddd;
            outline: none;
            border-radius: 5px;
            margin-top: 10px;
        }

        /* å»æ‰æ»‘å—é»˜è®¤æ ·å¼ */
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 15px;
            height: 15px;
            background: #333;
            border-radius: 50%;
        }

        /* æ»‘å—æ‹–åŠ¨æ—¶æ”¹å˜å›¾ç‰‡ç¼©æ”¾æ¯”ä¾‹ */
        input[type=range]:focus::-webkit-slider-thumb {
            box-shadow: 0 0 0 3px rgba(35, 173, 255, 0.5);
        }

        input[type=range]::-webkit-slider-runnable-track {
            height: 5px;
            background: #ddd;
        }

        input[type=range]::-moz-range-track {
            height: 5px;
            background: #ddd;
        }

        /* WebKit ä¸­ç”¨äºæ§åˆ¶æ»‘å—å¤–è§‚çš„ä¼ªå…ƒç´  */
        input[type=range]::-webkit-slider-thumb:before,
        input[type=range]::-webkit-slider-thumb:after {
            display: block;
            content: "";
        }

        /* æ”¹å˜å›¾ç‰‡ç¼©æ”¾æ¯”ä¾‹ */
        input[type=range]::-webkit-slider-thumb:before {
            transform: scale(var(--thumb-scl, 1));
            /* æ ¹æ®æ»‘å— value å€¼è®¡ç®—ç¼©æ”¾æ¯”ä¾‹ */
            --thumb-scl: calc(var(--slider-value) / 100);
        }

        /* ç»™æŒ‰é’®è®¾ç½®èƒŒæ™¯è‰² */
        button {
            background-color: #4CAF50;
            border: none;
            color: white;
            padding: 8px 20px;
            /* è®¾ç½®æŒ‰é’®å†…è¾¹è· */
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
            cursor: pointer;
            border-radius: 5px;
            /* è®¾ç½®æŒ‰é’®åœ†è§’ */
        }

        /* æ‚¬æµ®æ—¶æ”¹å˜èƒŒæ™¯è‰² */
        button:hover {
            background-color: #3e8e41;
        }
        .button-red {
            background-color: #f44336ee;
        }
        .button-red:hover {
            background-color: #f44336;
        }

        #floating-box {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #333;
            color: #fff;
            padding: 20px;
            border-radius: 5px;
            z-index: 9999;
            display: none;
        }

        #floating-box p {
            margin: 0;
        }
    </style>
</head>
<body>
    <h3>æ¨èç‚¹å‡»è¯„ä»·æŒ‰é’®ï¼Œç«™é•¿ä¼šå¯¹å›¾ç‰‡åšå‡ºè°ƒæ•´</h3>
    <button onclick="location.href='{{ url_for('Home') }}';">å›åˆ°é¦–é¡µ</button>
    <button onclick="previous()">ä¸Šä¸€ä¸ª</button>
    <button onclick="next()">ä¸‹ä¸€ä¸ª</button>
    <button id="Button0" onclick="sendRequest('0')" style="display:inline-block;">ğŸ‘</button>
    <button id="Button1" onclick="sendRequest('1')" style="display:inline-block;" color="red">ğŸ‘</button>
    <button id="Button2" onclick="sendRequest('2')" style="display:inline-block;" color="red" ;>åˆ†ç±»é”™äº†</button>
    <button id="Button3" class="button-red" onclick="download()" style="display:inline-block;">ä¸‹è½½</button>
    <select id="videoSelect" onchange="videoChange()"></select>
    <p id="myvideoText">1/?ç‚¹ä¸€ä¸‹ ä¸‹ä¸€ä¸ª å°±çŸ¥é“äº†</p>
    <div id="floating-box">
        <p id="message"></p>
    </div>
    <!-- è§†é¢‘å®¹å™¨ -->
    <div class="video-container">
        <video id="videoPlayer" controls preload="metadata">
            <!-- è¿™é‡Œçš„sourceæ ‡ç­¾å°†é€šè¿‡JavaScriptåŠ¨æ€æ›´æ–° -->
            <p>Your browser doesn't support HTML5 video. Here is a <a href="static/example.mp4">link to the video</a> instead.</p>
        </video>
    </div>    
</body>

<script>

    var currentvideoIndex = 0;
    var videos = {{ video_urls| safe }};
    var currentvideoPath = videos[currentvideoIndex];

    // è·å–ç›¸å…³å…ƒç´ 
    const video = document.querySelector(".video-container vidoe");

    function showMessage(message, duration) {
        var box = document.getElementById("floating-box");
        var msg = document.getElementById("message");

        // æ˜¾ç¤ºæ¶ˆæ¯
        msg.innerHTML = message;

        // æ˜¾ç¤ºæç¤ºæ¡†
        box.style.display = "block";

        // è‡ªåŠ¨å…³é—­
        if(duration!=0)
        {
        setTimeout(function () {
            box.style.display = "none";
        }, duration);
    }
    }


    function populateSelect(videos) {
  var select = document.getElementById('videoSelect');
  videos.forEach(function(video, index) {
    var option = document.createElement('option');
    option.value = video;
    option.textContent = decodeURIComponent(videos[index]);
    select.appendChild(option);
  });
}

function videoChange() {
    currentvideoIndex = document.getElementById('videoSelect').selectedIndex;
    updatevideo();
}

// Initialize the dropdown menu with videos when the page loads
window.onload = function() {
  populateSelect(videos);
  document.querySelector("#myvideoText").textContent = (currentvideoIndex + 1)+"/"+ (videos.length);
};

    function sendRequest(btnValue) {
        var xhr = new XMLHttpRequest();
        xhr.open("POST", "/like", true);
        var formData = new FormData();
        formData.append('btn', btnValue); // æ·»åŠ æ•°å­—ç±»å‹æ•°æ®
        formData.append('path', videos[currentvideoIndex]); // æ·»åŠ å­—ç¬¦ä¸²ç±»å‹æ•°æ®
        xhr.send(formData);
        xhr.onload = function () {
            if (btnValue == '0') {
                showMessage("ç‚¹èµæˆåŠŸ", 400);
            } else if (btnValue == '1') {
                showMessage("ç‚¹è¸©æˆåŠŸ", 400);
            } else {
                showMessage("ä¸ŠæŠ¥æˆåŠŸ", 400);
            }
            document.getElementById("Button" + btnValue).innerHTML = xhr.responseText + 'äººä¹Ÿè§‰å¾—';
        }
    }

    function previous() {
        if (currentvideoIndex === 0)
            currentvideoIndex = videos.length - 1;
        else 
            currentvideoIndex--;
        updatevideo();
    }

    function next() {
        if (currentvideoIndex === videos.length - 1)
            currentvideoIndex = 0;
        else
            currentvideoIndex++;
        updatevideo();
    }


    function updatevideo() {
    var videoElement = document.getElementById("videoPlayer");
    var txtElement = document.getElementById("myvideoText");

    // å‡è®¾videosæ˜¯ä¸€ä¸ªåŒ…å«è§†é¢‘URLçš„æ•°ç»„
    var videoSrc = videos[currentvideoIndex];
    videoElement.src = videoSrc; // æ›´æ–°è§†é¢‘æº
    txtElement.textContent = (currentvideoIndex + 1) + "/" + videos.length;

    // æ›´æ–°æŒ‰é’®æ–‡æœ¬
    document.getElementById("Button0").innerHTML = 'ğŸ‘';
    document.getElementById("Button1").innerHTML = 'ğŸ‘';
    document.getElementById("Button2").innerHTML = 'åˆ†ç±»é”™äº†';

    // ç›‘å¬è§†é¢‘åŠ è½½å¤±è´¥äº‹ä»¶
    videoElement.addEventListener('error', function() {
        if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
            if(confirm("è§†é¢‘æ— æ³•åŠ è½½ï¼Œæ˜¯å¦è·³è½¬åˆ°ç™»å½•ç•Œé¢ï¼Ÿ"))
                window.location.href = '/login'; // ç¡®ä¿è¿™æ˜¯æ­£ç¡®çš„ç™»å½•URL
        } else {
            alert('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒæ’­æ”¾æ­¤è§†é¢‘ï¼Œè¯·æ›´æ¢æµè§ˆå™¨æˆ–è€…å‡çº§æµè§ˆå™¨ç‰ˆæœ¬');
        }
    });

    videoElement.load(); // é‡è¦ï¼šè°ƒç”¨load()æ¥åŠ è½½æ–°è§†é¢‘
}


        function download() {
    var link = document.createElement('a');
    link.download = videos[currentvideoIndex].split('/')[2]; // è®¾ç½®ä¸‹è½½æ–‡ä»¶çš„åç§°
    link.href = videos[currentvideoIndex]; // è¿™é‡Œçš„è·¯å¾„åº”è¯¥æ˜¯æœåŠ¡å™¨ç«¯å­˜å‚¨æ–‡ä»¶çš„åœ°å€
    document.body.appendChild(link);
    link.click(); // æ¨¡æ‹Ÿç”¨æˆ·ç‚¹å‡»é“¾æ¥ä»¥è§¦å‘ä¸‹è½½
    document.body.removeChild(link); // ç§»é™¤é“¾æ¥èŠ‚ç‚¹
}


</script>


</html>
