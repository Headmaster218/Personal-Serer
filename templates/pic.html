<!--
 * @Author: Headmaster1615  e-mail:hm-218@qq.com
 * @Date: 2023-05-15 11:55:24
 * @LastEditors: Headmaster1615(Mac)  e-mail:hm-218@qq.com
 * @LastEditTime: 2023-10-13 11:06:36
 * @FilePath: \ä¸ªäººæœåŠ¡å™¨\templates\pic.html
 * @Description: 
 * 
 * Copyright (c) 2023 by Headmaster1615, All Rights Reserved. 
-->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>ç¾å›¾æŸ¥çœ‹å™¨</title>
    <style>
        body {
            background-image: url('/static/pic_bgd.jpg');
            background-size: cover;
        }

        h3,
        p {
            color: rgb(255, 255, 255);
            margin: 0%;
            /* è®¾ç½®é¢œè‰² */
        }

        /* è®¾ç½®æ»‘å—å®¹å™¨æ ·å¼ */
        .slider-container {
            width: 80%;
            margin-bottom: auto;
            padding-bottom: 0.5%;
            background:#39baff89;
            outline: #ddd;
            /* æ°´å¹³å±…ä¸­ */
            margin-left: 10%;
        }

        /* å›¾ç‰‡å®¹å™¨æ ·å¼ */
        /*è®¾ç½®åŸç‚¹åœ¨ä¸­ä¸Š*/
        .image-container {
            width: 100vw;
            height: 90vh;
            overflow: hidden;
            /* é¿å…å›¾åƒæº¢å‡º */
            position: relative;
            top: 50%;
        }

        /* å›¾ç‰‡æ ·å¼ */
        .image-container img {
            max-width: 100%;
            max-height: 100%;
            top: 0;
            left: 0%;
            transform-origin: center top;
        }

        /* æ»‘å—æ ·å¼ */
        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            height: 5px;
            background: rgba(9, 235, 69, 0.548);
            outline: lightblue;
            border-radius: 1px;
            margin-top: 0.5px;
        }

        /* å»æ‰æ»‘å—é»˜è®¤æ ·å¼ */
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 15px;
            height: 15px;
            background: #333;
            border-radius: 50%;
        }

        /* æ»‘å—æ‹–åŠ¨æ—¶æ”¹å˜å›¾ç‰‡ç¼©æ”¾æ¯”ä¾‹ */
        input[type=range]:focus::-webkit-slider-thumb {
            box-shadow: 0 0 0 3px rgba(35, 173, 255, 0.5);
        }

        input[type=range]::-webkit-slider-runnable-track {
            height: 5px;
            background: #ddd;
        }

        input[type=range]::-moz-range-track {
            height: 5px;
            background: #ddd;
        }

        /* WebKit ä¸­ç”¨äºæ§åˆ¶æ»‘å—å¤–è§‚çš„ä¼ªå…ƒç´  */
        input[type=range]::-webkit-slider-thumb:before,
        input[type=range]::-webkit-slider-thumb:after {
            display: block;
            content: "";
        }

        /* æ”¹å˜å›¾ç‰‡ç¼©æ”¾æ¯”ä¾‹ */
        input[type=range]::-webkit-slider-thumb:before {
            transform: scale(var(--thumb-scl, 1));
            /* æ ¹æ®æ»‘å— value å€¼è®¡ç®—ç¼©æ”¾æ¯”ä¾‹ */
            --thumb-scl: calc(var(--slider-value) / 100);
        }

        /* ç»™æŒ‰é’®è®¾ç½®èƒŒæ™¯è‰² */
        button {
            background-color: #4CAF50;
            border: none;
            color: white;
            padding: 8px 20px;
            /* è®¾ç½®æŒ‰é’®å†…è¾¹è· */
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
            cursor: pointer;
            border-radius: 5px;
            /* è®¾ç½®æŒ‰é’®åœ†è§’ */
        }

        .button-red {
            background-color: #f44336ee;
        }
        .button-red:hover {
            background-color: #f44336;
        }
        

        /* æ‚¬æµ®æ—¶æ”¹å˜èƒŒæ™¯è‰² */
        button:hover {
            background-color: #3e8e41;
        }

        #floating-box {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #333;
            color: #fff;
            padding: 20px;
            border-radius: 5px;
            z-index: 9999;
            display: none;
        }

        #floating-box p {
            margin: 0;
        }
    </style>
</head>

<body>
    <button onclick="location.href='/Home';">å›åˆ°é¦–é¡µ</button>
    <button onclick="previous()">ä¸Šä¸€å¼ </button>
    <button onclick="next()">ä¸‹ä¸€å¼ </button>
    <!-- æˆæƒç”¨æˆ· -->
    {% if username == 1 %}
    <button onclick="changeImage2Npic()">åˆ‡æ¢é«˜çº§ç‰ˆ</button>
    <button onclick="changeImage2pic()">åˆ‡æ¢æ™®é€šç‰ˆ</button>
    {% endif %}
    <button id="Button0" onclick="sendRequest('0')" style="display:inline-block;">ğŸ‘</button>
    <button id="Button1" onclick="sendRequest('1')" style="display:inline-block;">ğŸ‘</button>
    <button id="Button2" onclick="sendRequest('2')" style="display:inline-block;">åˆ†ç±»é”™äº†</button>
    <button id="Button3" class="button-red" onclick="download()" style="display:inline-block;">ä¸‹è½½</button>
    <button id="Button4" onclick="help()" style="display:inline-block;">å¸®åŠ©</button>
    <p id="myImageText">1/1742</p>
    <div id="floating-box">
        <p id="message"></p>
    </div>
    <div class="slider-container">
        <input type="range" min="50" max="200" value="100" id="zoom-slider">
    </div>
    <center>
        <div class="image-container">
           <img src='{{ "/pic_src/" + pic_image_urls[0] }}' alt="1/1742">
    </center>
    </div>
</body>

    <script>

        var currentImageIndex = 0;
        var images = {{ pic_image_urls| safe }};
        var currentImagePath = images[currentImageIndex];
        // è·å–ç›¸å…³å…ƒç´ 
        const slider = document.querySelector("#zoom-slider");
        const image = document.querySelector(".image-container img");

        help();

        function help(){
            alert("æ¬¢è¿ä½¿ç”¨!å·¦å³æ–¹å‘é”®å¯åˆ‡æ¢å›¾ç‰‡\næ‹–åŠ¨æ»‘åŠ¨æ¡æˆ–ä¸Šä¸‹é”®å¯ä»¥è°ƒèŠ‚å›¾ç‰‡å¤§å°\næ¨èç‚¹å‡»è¯„ä»·æŒ‰é’®ï¼Œç«™é•¿ä¼šå¯¹å›¾ç‰‡åšå‡ºè°ƒæ•´ã€‚");
        }
        // è®¾ç½®æ»‘å—å½“å‰å€¼ï¼ˆå³åˆå§‹å€¼ï¼‰
        let sliderValue = slider.value;

        // ç›‘å¬æ»‘å—æ‹–åŠ¨äº‹ä»¶ï¼Œå¹¶æ ¹æ® value å€¼æ”¹å˜å›¾ç‰‡ç¼©æ”¾æ¯”ä¾‹
        slider.addEventListener("input", (e) => {
            sliderValue = e.target.value;
            image.style.transform = `scale(${sliderValue / 100})`;
        });

        // ç›‘å¬çª—å£å¤§å°å˜åŒ–äº‹ä»¶ï¼Œé‡æ–°è®¾ç½®æ»‘å—å’Œå›¾ç‰‡å¤§å°
        window.addEventListener("resize", () => {
            // è®¡ç®—å›¾ç‰‡å®¹å™¨çš„å®½é«˜æ¯”ä¾‹
            const aspectRatio = image.naturalWidth / image.naturalHeight;

            // è®¾ç½®æ»‘å—æœ€å°å€¼ã€æœ€å¤§å€¼å’Œå½“å‰å€¼ï¼ˆå³åˆå§‹å€¼ï¼‰
            slider.min = Math.round(50 / aspectRatio);
            slider.max = Math.round(200 / aspectRatio);
            slider.value = sliderValue;

            // è°ƒæ•´å›¾ç‰‡å¤§å°
            image.style.width = "auto";
            image.style.height = "auto";
            image.style.transform = `scale(${sliderValue / 100})`;
        });

        function showMessage(message, duration) {
            var box = document.getElementById("floating-box");
            var msg = document.getElementById("message");

            // æ˜¾ç¤ºæ¶ˆæ¯
            msg.innerHTML = message;

            // æ˜¾ç¤ºæç¤ºæ¡†
            box.style.display = "block";

            // è‡ªåŠ¨å…³é—­
            if(duration!=0)
            {
            setTimeout(function () {
                box.style.display = "none";
            }, duration);
        }
        }

        function sendRequest(btnValue) {
            var xhr = new XMLHttpRequest();
            xhr.open("POST", "/like", true);
            var formData = new FormData();
            formData.append('btn', btnValue); // æ·»åŠ æ•°å­—ç±»å‹æ•°æ®
            formData.append('path', images[currentImageIndex]); // æ·»åŠ å­—ç¬¦ä¸²ç±»å‹æ•°æ®
            xhr.send(formData);
            xhr.onload = function () {
                if (btnValue == '0') {
                    showMessage("ç‚¹èµæˆåŠŸ", 400);
                } else if (btnValue == '1') {
                    showMessage("ç‚¹è¸©æˆåŠŸ", 400);
                } else {
                    showMessage("ä¸ŠæŠ¥æˆåŠŸ", 400);
                }
                document.getElementById("Button" + btnValue).innerHTML = xhr.responseText + 'äººä¹Ÿè§‰å¾—';
            }
        }

        document.addEventListener('keydown', function(event) {
            if(event.keyCode == 37) {
                // å·¦ç®­å¤´é”®è¢«æŒ‰ä¸‹
                previous();
            }
            else if(event.keyCode == 39) {
                // å³ç®­å¤´é”®è¢«æŒ‰ä¸‹
                next();
            }
            else if(event.keyCode == 38) {
                // ä¸Šé”®
                slider.value = parseInt(slider.value) + 10;
                image.style.transform = `scale(${slider.value / 100})`;
            }
            else if(event.keyCode == 40) {
                // ä¸‹é”®
                slider.value = parseInt(slider.value) - 10;
                image.style.transform = `scale(${slider.value / 100})`;
            }
        });

        function previous() {
            if (currentImageIndex === 0) {
                currentImageIndex = images.length - 1;
            }
            else {
                currentImageIndex--;
            }
            updateImage();
        }

        function next() {
            if (currentImageIndex === images.length - 1) {
                currentImageIndex = 0;
            }
            else {
                currentImageIndex++;
            }
            updateImage();
        }


        function preloadImages(imageUrls) {
    imageUrls.forEach(function(url) {
        var img = new Image();
        img.src = url;
    });
}

function updateImage() {
    var imgElement = document.querySelector("img");
    var txtElement = document.querySelector("#myImageText");

    imgElement.setAttribute("src","/pic_src/" + images[currentImageIndex]);
    showMessage("åŠ è½½ä¸­,ä¸è¦é‡å¤ç‚¹å‡»...", 0);

    // é¢„åŠ è½½åé¢çš„ä¸‰å¼ å›¾ç‰‡
    var nextImages = images.slice(currentImageIndex + 1, currentImageIndex + 4);
    preloadImages(nextImages.map(function(img) { return "/pic_src/" + img; }));

    // ç›‘å¬å›¾ç‰‡åŠ è½½äº‹ä»¶
    imgElement.addEventListener('load', function() {
        // å›¾ç‰‡åŠ è½½å®Œæˆåæ‰§è¡Œä»¥ä¸‹ä»£ç 
        document.getElementById("floating-box").style.display = 'none';
        imgElement.setAttribute("alt", (currentImageIndex + 1)+"/"+ (images.length+1));
        txtElement.textContent = (currentImageIndex + 1)+"/"+ (images.length+1);
        document.getElementById("Button0").innerHTML = 'ğŸ‘';
        document.getElementById("Button1").innerHTML = 'ğŸ‘';
        document.getElementById("Button2").innerHTML = 'åˆ†ç±»é”™äº†';
        document.getElementById("Button3").innerHTML = 'ä¸‹è½½'+this.naturalWidth+'X'+this.naturalHeight;
    });

    // ç›‘å¬å›¾ç‰‡åŠ è½½å¤±è´¥äº‹ä»¶,æœªç™»å½•æ—¶è·³è½¬åˆ°ç™»å½•é¡µé¢
    imgElement.addEventListener('error', function() {
        window.location.href ="/pic_src/" + images[currentImageIndex];
    });
}


        function download() {
            var link = document.createElement('a');
            link.download = images[currentImageIndex].split('/')[2]; // è®¾ç½®ä¸‹è½½æ–‡ä»¶çš„åç§°
            link.href = "/pic_src/" + images[currentImageIndex]; // è¿™é‡Œçš„è·¯å¾„åº”è¯¥æ˜¯æœåŠ¡å™¨ç«¯å­˜å‚¨æ–‡ä»¶çš„åœ°å€
            document.body.appendChild(link);
            window.open(link.href);
            document.body.removeChild(link); // ç§»é™¤é“¾æ¥èŠ‚ç‚¹
        }

        function changeImage2Npic() {
            images = {{ Npic_image_urls | safe }};
        updateImage();
        }

        function changeImage2pic() {
            images = {{ pic_image_urls | safe }};
        updateImage();
        }



    </script>


</html>